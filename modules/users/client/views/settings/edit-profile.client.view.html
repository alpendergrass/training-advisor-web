<section ng-controller="EditProfileController">
  <h3>About Me</h3>
  <div class="top-buffer-4x">
    <label>Name * :&nbsp;
      <a href="#" editable-text="user.firstName" e-required onbeforesave="checkFirstName($data)">{{ user.firstName  }}</a>&nbsp;
      <a href="#" editable-text="user.lastName" e-required onbeforesave="checkLastName($data)">{{ user.lastName  }}</a></label>
    <hr>
    <label>Email * :&nbsp;
      <a href="#" editable-email="user.email" e-required onbeforesave="checkEmail($data)">{{ user.email || 'email' }}</a>
    </label>
    <hr>
    <label for="timezone">My Timezone *</label>
    <div class="text-danger bottom-buffer" ng-show="!user.timezone"><strong>* Please select your timezone *</strong></div>
    <timezone-selector name="timezone" id="timezone" ng-model="user.timezone" ng-change="updateUserProfile()" sort-by="offset" show-local="true" width="230px" class="small"></timezone-selector>
    <hr>
    <label>Functional Threshold Power *</label>
    <div class="text-danger bottom-buffer" ng-show="user.ftpLog.length < 1"><strong>* Please provide FTP *</strong></div>
    <div>
      <p>
        <table class="table table-hover">
          <thead ng-show="user.ftpLog.length > 0">
            <tr style="font-weight: bold">
              <th>FTP</th>
              <th>Date</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="ftpLogItem in user.ftpLog">
              <td>
                <a href="#" editable-number="ftpLogItem.ftp" e-name="ftp" e-min="1" e-max="999" e-step="1" e-required onaftersave="updateUserProfile()">{{ ftpLogItem.ftp }}</a>
              </td>
              <td>
                <a href="#" editable-bsdate="ftpLogItem.ftpDate" onaftersave="updateUserProfile()" e-required e-readonly="true" e-show-calendar-button="true" e-datepicker-options="ftpDateOptions" e-is-open="ftpDatePickerStatus.opened" e-show-button-bar="false" e-ng-click="openFtpDatePicker($event)" e-datepicker-popup="dd MMMM yyyy">
                        {{ ftpLogItem.ftpDate | date:"dd MMMM yyyy" }}
                      </a>
              </td>
              <td>
                <button class="btn btn-default" title="Remove FTP" ng-click="removeFTP(ftpLogItem)">
                  <span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span>
                </button>
              </td>
            </tr>
            <tr ng-show="newFtp">
              <td>
                <span editable-number="newFtp.ftp" e-name="newFtp.ftp" e-min="1" e-max="999" e-step="1" e-form="newFtpForm" onbeforesave="validateFtp($data)"></span>
              </td>
              <td>
                <span editable-bsdate="newFtp.ftpDate" e-name="newFtp.ftpDate" e-readonly="true" e-show-calendar-button="true" e-datepicker-options="ftpDateOptions" e-is-open="newFtpDatePickerStatus.opened" e-show-button-bar="false" e-ng-click="openNewFtpDatePicker($event)" e-datepicker-popup="dd MMMM yyyy" e-form="newFtpForm"></span>
              </td>
              <td>
                <form editable-form name="newFtpForm" ng-show="newFtpForm.$visible" onaftersave="updateUserProfile()" class="form-buttons form-inline" shown="inserted == newFtp">
                  <div class="buttons">
                    <button type="submit" ng-disabled="newFtpForm.$waiting" class="btn btn-primary btn-sm">save</button>
                    <button type="button" ng-disabled="newFtpForm.$waiting" ng-click="cancelAddFTP()" class="btn btn-default btn-sm">
                      cancel
                    </button>
                  </div>
                </form>
              </td>
            </tr>
          </tbody>
        </table>
      </p>
    </div>
    <div>
      <p>
        <button class="btn btn-default" title="Add ftpLogItem" ng-hide="newFtp" ng-click="addFTP()">
          <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span>
        </button>
      </p>
    </div>
  </div>
  <hr>
  <h3>Preferences</h3>
  <div class="top-buffer-4x">
    <label for="emailNewsletter">Newsletter :&nbsp;
      <a href="#" editable-checkbox="user.emailNewsletter" e-title="Send the Tacit Training newsletter?" buttons="no" onaftersave="updateUserProfile()">{{ user.emailNewsletter && "Send me the email newsletter" || "Do not send me the email newsletter" }}</a></label>
    <hr>
    <label>
      <a tabindex="0" role="button" data-toggle="popover" data-content="You may select one or more days that you typically rest to have Tacit Training schedule these days as rest days.">
        <span class="popup-link text-muted">Rest Days</span></a> :&nbsp;
      <a href="#" editable-select="user.preferredRestDays" e-multiple e-ng-options="s.value as s.text for s in ::data.daysOfTheWeek" onaftersave="updateUserProfile()">{{ showRestDays() }}</a>
    </label>
    <hr>
    <label>
      <a tabindex="0" role="button" data-toggle="popover" data-placement="top" data-content="If you select 'Fetch Strava activities automatically', when Strava notifies us of new activities we will retrieve your activity data from Strava. Otherwise you will need to manually sync your Strava activities on My Training Day page.">
        <span class="popup-link text-muted">Strava Sync</span>
      </a> :&nbsp;
      <a href="#" editable-radiolist="user.autoFetchStravaActivities" e-ng-options="s.value as s.text for s in ::data.autoFetchOptions track by s.value" buttons="no" onaftersave="updateUserProfile()">{{ user.autoFetchStravaActivities && "Auto-fetch" || "Do not auto-fetch" }}</a></label>
    </label>
    <div class="text-danger bottom-buffer" ng-show="user.autoFetchStravaActivities === null"><strong>* Please select an auto-fetch option *</strong></div>
    <hr>
    <label for="levelOfDetail">Level of Detail :&nbsp;
      <a href="#" editable-radiolist="user.levelOfDetail" e-ng-options="s.value as s.text for s in ::data.levelsOfDetail track by s.value" buttons="no" onaftersave="updateUserProfile()">{{ showLevelOfDetail() }}</a></label>
    <hr>
    <label><a tabindex="0" role="button" data-toggle="popover" data-placement="top" data-content="If power meter data is not available for a ride, by default we use Strava's estimated power to compute Training Load. However, some users report that estimated power is not reliable in their region. If you prefer, we can use Strava's Suffer Score for your Training Load rather than computing Training Load using estimated power. Note that Strava provides Suffer Score for Strava Premium members only and is only provided if heart rate is recorded for your ride."><span class="popup-link text-muted">Estimated Power or Suffer Score</span></a>
      <span class="small text-danger"><em>Experimental</em></span> :&nbsp;
      <a href="#" editable-checkbox="user.favorSufferScoreOverEstimatedPower" e-title="Use Suffer Score When No Power Meter?" buttons="no" onaftersave="updateUserProfile()">{{ user.favorSufferScoreOverEstimatedPower && "Use Suffer Score When No Power Meter" || "Use Estimated Power When No Power Meter" }}</a></label>
  </div>
</section>
